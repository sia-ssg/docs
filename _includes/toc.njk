<nav class="docs-toc" id="table-of-contents">
  <div class="toc-header">
    <h3>On this page</h3>
  </div>
  <ul class="toc-list" id="toc-list">
    {# Table of contents will be generated by JavaScript from page headings #}
  </ul>
</nav>

<script>
  (function() {
    function initTOC() {
      const tocList = document.getElementById('toc-list');
      if (!tocList) {
        // Retry if element not found yet
        if (document.readyState === 'loading') {
          return;
        }
        setTimeout(initTOC, 100);
        return;
      }
      
      // Clear any existing items
      tocList.innerHTML = '';
      
      const contentMain = document.querySelector('.docs-content-main');
      if (!contentMain) {
        const tocContainer = document.getElementById('table-of-contents');
        if (tocContainer) {
          tocContainer.style.display = 'none';
        }
        return;
      }
      
      const headings = contentMain.querySelectorAll('h2, h3');
      if (headings.length === 0) {
        const tocContainer = document.getElementById('table-of-contents');
        if (tocContainer) {
          tocContainer.style.display = 'none';
        }
        return;
      }
      
      headings.forEach(function(heading) {
        // Ensure heading has an ID
        if (!heading.id) {
          const id = heading.textContent.toLowerCase()
            .replace(/[^\w\s-]/g, '')
            .replace(/\s+/g, '-')
            .replace(/-+/g, '-')
            .trim();
          heading.id = id || 'heading-' + Math.random().toString(36).substr(2, 9);
        }
        
        // Create TOC item
        const li = document.createElement('li');
        const level = heading.tagName.toLowerCase();
        li.className = `toc-item toc-${level}`;
        
        const a = document.createElement('a');
        a.href = `#${heading.id}`;
        a.textContent = heading.textContent.trim();
        a.addEventListener('click', function(e) {
          e.preventDefault();
          heading.scrollIntoView({ behavior: 'smooth', block: 'start' });
          window.history.pushState(null, '', `#${heading.id}`);
        });
        
        li.appendChild(a);
        tocList.appendChild(li);
      });
    }
    
    // Run when DOM is ready, with fallback
    function runInit() {
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', function() {
          requestAnimationFrame(initTOC);
        });
      } else {
        // DOM is already ready, but wait for next frame to ensure rendering is complete
        requestAnimationFrame(initTOC);
      }
    }
    
    runInit();
  })();
</script>

